suppressPackageStartupMessages({
library(readr)
library(dplyr)
})
assign_path <- "data/AWS/icefalls_nearest_station.csv"
if (!file.exists(assign_path)) stop("Fehlt: ", assign_path)
assign <- read_csv(assign_path, show_col_types = FALSE)
if (!("uid" %in% names(assign))) stop("Spalte 'uid' fehlt in ", assign_path)
uids <- sort(unique(assign$uid))
uids <- uids[is.finite(uids)]
if (length(uids) == 0) stop("Keine UIDs gefunden.")
dir.create("site/plots", recursive = TRUE, showWarnings = FALSE)
# Diagramm-Skript Pfad (anpassen, wie du es ablegst)
plot_script <- "scripts/diagram_uid.R"
if (!file.exists(plot_script)) stop("Fehlt Diagramm-Skript: ", plot_script)
failed <- integer(0)
for (u in uids) {
message("\n==============================")
message("ğŸ“ˆ Build Plot UID: ", u)
message("==============================")
ok <- TRUE
tryCatch({
# neuer Prozess pro UID (robuster als source())
system2("Rscript", c(plot_script, as.character(u)), stdout = "", stderr = "")
}, error = function(e) {
ok <<- FALSE
message("âŒ UID ", u, " fehlgeschlagen: ", e$message)
})
if (!ok) failed <- c(failed, u)
}
